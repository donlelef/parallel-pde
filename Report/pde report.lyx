#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage[dvipsnames]{xcolor}
\usepackage[bottom]{footmisc}
\end_preamble
\use_default_options true
\begin_modules
eqs-within-sections
figs-within-sections
tabs-within-sections
logicalmkup
\end_modules
\maintain_unincluded_children false
\language british
\language_package auto
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen false
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder false
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle true
\papersize a4paper
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2cm
\topmargin 2.5cm
\rightmargin 2cm
\bottommargin 2.5cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\listings_params "language=C,keywordstyle={\color{cyan}},moredelim={[l][\color{BrickRed}]{\#pragma}},commentstyle={\color{magenta}\itshape},emphstyle={\color{blue}},emph={int,char,double,float,unsigned},breaklines=true,basicstyle={\ttfamily},stringstyle={\color{green}},identifierstyle={\color{black}},numbers=left,numbersep=3pt,tabsize=2"
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
Finite Elements Methods: a parallel implementation
\end_layout

\begin_layout Author
Simone Colucci & Emanuele Fabbiani
\end_layout

\begin_layout Date
February 
\begin_inset Formula $15^{th}$
\end_inset

, 2016
\end_layout

\begin_layout Abstract
The Finite Elements algorithm is implemented through a C program and applied
 to an elliptic partial differential equation.
 A serial version is run on several mesh with growing size.
 The execution time is recorded and compared with theoretical prediction
 based on computational complexity.
 The results are coherent with the predictions.
 Using OpenMP directives, the code is made parallel and run on different
 machines.
 For every major function, the time gain is predicted using Ahmdal's law
 and then measured.
 The results show an overall improvement of the performance, even if lower
 than the theoretical limit.
 Other ways to speed up the executions are explored: an automatic optimisation
 of the machine code is tested.
 The optimised code outperforms both the serial and the parallel versions:
 an explanation is found looking to the improvement the compiler performs
 on the assembly.
\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Partial differential equations and finite element methods.
\end_layout

\begin_layout Standard
Partial differential equations (PDE) are differential equations where the
 unknown is a multivariable function.
 Far from being just complex mathematical problems, PDEs are very useful
 tools to model several different phenomena in Physics, Biology, Economics
 and Engineering.
 Maxwell's laws of electromagnetic fields and Navier-Stokes equations for
 fluids are just two examples of major applications of PDE theory.
 However, PDEs are usually impossible to solve in closed form: numerical
 methods are required to compute approximate solutions.
 The most used methods to solve PDEs numerically are known as Finite Element
 Methods.
 First introduced in the '40s FEMs utility was underestimated at the time
 because of the lack of computational power.
 Nowadays they enter the design process of planes, buildings and cars as
 a low-cost and effective alternative to real stress tests.
\end_layout

\begin_layout Subsection
The Finite Element Method
\end_layout

\begin_layout Standard
To understand how the method works, we consider an elliptic homogeneous
 equation:
\begin_inset Formula 
\begin{equation}
\begin{cases}
-\Delta u\left(x,y\right)=f\left(x,y\right) & in\:\Omega\\
u=g\left(x,y\right) & on\:\partial\Omega
\end{cases}
\end{equation}

\end_inset

where 
\begin_inset Formula $\Delta u\left(x,y\right)=\frac{\partial^{2}u\left(x,y\right)}{\partial x^{2}}+\frac{\partial^{2}u\left(x,y\right)}{\partial y^{2}}$
\end_inset

 and 
\begin_inset Formula $f:\mathbb{R}^{2}\mapsto\mathbb{R}$
\end_inset

 is a well-defined function in 
\begin_inset Formula $\Omega\in\mathbb{R}^{2}$
\end_inset

.
 FEMs are based on the weak formulation of the differential problem, so
 we have to introduce a test function 
\begin_inset Formula $v$
\end_inset

, which is supposed to be regular enough.
 We multiply the differential equation by 
\begin_inset Formula $v$
\end_inset

 and we integrate over 
\begin_inset Formula $\Omega$
\end_inset

:
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\left(-\Delta u\right)v=\int_{\Omega}fv
\end{equation}

\end_inset

Then we apply the Gauss-Green formula:
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\Delta uv+\int_{\Omega}\nabla u\cdot\nabla v=\int_{\partial\Omega}v\frac{\partial u}{\partial n}
\end{equation}

\end_inset

And we choose 
\begin_inset Formula $v$
\end_inset

 such that 
\begin_inset Formula $v|_{\partial\Omega}\equiv0$
\end_inset

.
 We got to the weak formulation:
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\nabla u\cdot\nabla v=\int_{\partial\Omega}v\frac{\partial u}{\partial n}+\int_{\Omega}fv
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\int_{\Omega}\nabla u\cdot\nabla v=\int_{\Omega}fv\label{eq:debole}
\end{equation}

\end_inset

This equation should hold for every 
\begin_inset Formula $v$
\end_inset

.
 Up to here, no approximation has been performed.
 Form now on, the Finite Elements approximation begins.
 We approximate the set 
\begin_inset Formula $\Omega$
\end_inset

 with the union of triangles 
\begin_inset Formula $\mathcal{T}_{h}$
\end_inset

.
\begin_inset Formula 
\begin{equation}
\Omega\simeq\bigcup_{T\in\mathcal{T}_{h}}T
\end{equation}

\end_inset

The equality holds only if 
\begin_inset Formula $\Omega$
\end_inset

 is a polygon.
 The length 
\begin_inset Formula $h$
\end_inset

 of the longest edge of a triangle 
\begin_inset Formula $T\in\mathcal{T}_{h}$
\end_inset

 is a good index about how fine the mesh is.
 Then we approximate the function 
\begin_inset Formula $u$
\end_inset

 with a new function 
\begin_inset Formula $u_{h}$
\end_inset

, which is supposed to be linear on every triangle 
\begin_inset Formula $T$
\end_inset

 and continuous on 
\begin_inset Formula $\Omega$
\end_inset

; moreover we want the test function 
\begin_inset Formula $v$
\end_inset

 to present the same features.
 To underline the restriction, 
\begin_inset Formula $v$
\end_inset

 will be called 
\begin_inset Formula $v_{h}$
\end_inset

.
 It is possible to show that the functional space 
\begin_inset Formula $u_{h}$
\end_inset

 and 
\begin_inset Formula $v_{h}$
\end_inset

 belong to has a dimension which is finite and equals the number 
\begin_inset Formula $n$
\end_inset

 of vertexes of triangles in the internal of the set 
\begin_inset Formula $\Omega$
\end_inset

.
 We define 
\begin_inset Formula $\varphi_{i}$
\end_inset

, 
\begin_inset Formula $i=1...n$
\end_inset

 a set of functions which is a basis for the functional space 
\begin_inset Formula $v$
\end_inset

 and 
\begin_inset Formula $u$
\end_inset

 belongs to:
\begin_inset Formula 
\begin{equation}
u_{h}\left(x,y\right)=\sum_{i=1}^{n}u_{i}\varphi_{i}\left(x,y\right)
\end{equation}

\end_inset

The equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:debole"

\end_inset

 is verified by every 
\begin_inset Formula $v$
\end_inset

 if and only if it holds for all the elements 
\begin_inset Formula $\varphi_{j}$
\end_inset

 in a basis of the functional space.
 We impose this condition and we get to the following linear system:
\begin_inset Formula 
\begin{equation}
\sum_{i=1}^{n}u_{i}\int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{j}=\int_{\Omega}f\cdot\varphi_{j}\;\;\forall j=1...n\label{eq:FEM-sys}
\end{equation}

\end_inset

We define 
\begin_inset Formula $W=\left\{ W_{i,j}\right\} =\int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{j}$
\end_inset

, 
\begin_inset Formula $u=\left\{ u_{i}\right\} $
\end_inset

 and 
\begin_inset Formula $b=\left\{ b_{j}\right\} \coloneqq\int_{\Omega}f\cdot\varphi_{j}$
\end_inset

, so that we can write the system in matrix form:
\begin_inset Formula 
\begin{equation}
Wu=b
\end{equation}

\end_inset

We can exploit the linearity of the integral to ease the computation of
 
\begin_inset Formula $W$
\end_inset

 and 
\begin_inset Formula $b$
\end_inset

: we can compute the contribution on every triangle 
\begin_inset Formula $T$
\end_inset

 and then sum them up.
 We choose the easiest set of basic functions 
\begin_inset Formula $\varphi$
\end_inset

, that is the 
\begin_inset Formula $\varphi_{j}=1$
\end_inset

 on the vertex with index 
\begin_inset Formula $j$
\end_inset

 and 0 on all the others.
 The computation of the local matrix 
\begin_inset Formula $W_{T}$
\end_inset

 of the triangle 
\begin_inset Formula $T$
\end_inset

 lead to a symmetric matrix:
\begin_inset Formula 
\begin{equation}
W_{T}=\begin{bmatrix}\int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{i} & \int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{j} & \int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{k}\\
\int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{j} & \int_{\Omega}\nabla\varphi_{j}\cdot\nabla\varphi_{j} & \int_{\Omega}\nabla\varphi_{j}\cdot\nabla\varphi_{k}\\
\int_{\Omega}\nabla\varphi_{i}\cdot\nabla\varphi_{k} & \int_{\Omega}\nabla\varphi_{j}\cdot\nabla\varphi_{k} & \int_{\Omega}\nabla\varphi_{k}\cdot\nabla\varphi_{k}
\end{bmatrix}=\frac{1}{4\left|T\right|}\begin{bmatrix}l_{i}\cdot l_{i} & l_{i}\cdot l_{j} & l_{i}\cdot l_{k}\\
l_{j}\cdot l_{i} & l_{j}\cdot l_{j} & l_{j}\cdot l_{k}\\
l_{k}\cdot l_{i} & l_{k}\cdot l_{j} & l_{k}\cdot l_{k}
\end{bmatrix}
\end{equation}

\end_inset

where 
\begin_inset Formula $\left|T\right|$
\end_inset

 is the area of the triangle and 
\begin_inset Formula $l_{i}\cdot l_{j}$
\end_inset

 is the scalar product between the edges described by the vectors 
\begin_inset Formula $l_{i}$
\end_inset

 and 
\begin_inset Formula $l_{j}$
\end_inset

.
 We can compute the local right-hand side 
\begin_inset Formula $b_{T}$
\end_inset

, using some quadrature formula.
 We choose the barycentre formula, the easiest one:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
b_{T}=\begin{bmatrix}\int_{\Omega}f\cdot\varphi_{i}\\
\int_{\Omega}f\cdot\varphi_{j}\\
\int_{\Omega}f\cdot\varphi_{k}
\end{bmatrix}\simeq\frac{\left|T\right|}{3}\begin{bmatrix}f\left(x_{B},y_{B}\right)\\
f\left(x_{B},y_{B}\right)\\
f\left(x_{B},y_{B}\right)
\end{bmatrix}
\end{equation}

\end_inset

dove
\begin_inset Formula 
\begin{equation}
x_{B}=\frac{1}{3}\sum_{i=1}^{3}x_{i}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
y_{B}=\frac{1}{3}\sum_{i=1}^{3}y_{i}
\end{equation}

\end_inset

It can be proved that this formula is exact if and only if the function
 
\begin_inset Formula $f$
\end_inset

 is constant on the border of 
\begin_inset Formula $\Omega$
\end_inset

.
\end_layout

\begin_layout Subsection
Model problem
\end_layout

\begin_layout Standard
We take the following partial differential equation as a model:
\begin_inset Formula 
\begin{equation}
\begin{cases}
-\Delta u\left(x,y\right)=-4 & in\:\Omega=\left\{ \left(x,y\right)\in\mathbb{R}^{2}:x^{2}+y^{2}\leq1\right\} \\
u=1 & on\:\partial\Omega=\left\{ \left(x,y\right)\in\mathbb{R}^{2}:x^{2}+y^{2}=1\right\} 
\end{cases}
\end{equation}

\end_inset

We choose this very equation because we can deduce the true solution.
 If we try 
\begin_inset Formula 
\begin{equation}
\tilde{u}\left(x,y\right)=x^{2}+y^{2}
\end{equation}

\end_inset

we get:
\begin_inset Formula 
\begin{equation}
-\Delta\tilde{u}\left(x,y\right)=-\frac{\partial^{2}\tilde{u}\left(x,y\right)}{\partial x^{2}}-\frac{\partial^{2}\tilde{u}\left(x,y\right)}{\partial y^{2}}=-2-2=-4
\end{equation}

\end_inset

As the solution to such a problem is proved to be unique, 
\begin_inset Formula $\tilde{u}$
\end_inset

 is the function we are looking for.
\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Serial implementation
\begin_inset CommandInset label
LatexCommand label
name "sec:Serial-implementation"

\end_inset


\end_layout

\begin_layout Standard
We shall consider now the actual C-language implementation
\begin_inset Foot
status open

\begin_layout Plain Layout
The code is hosted in a Github repository: 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://github.com/donlelef/parallel-pde.git
\end_layout

\end_inset

.
\end_layout

\end_inset

 of the algorithm that compute the approximate solution of the given problem
 with a finite elements approach.
 In order to focus on the interesting parts, we will disregard I/O operations:
 they are essential to the program execution but do not represent any case
 of study.
\end_layout

\begin_layout Standard
Roughly speaking, the code can be split into four sections: 
\end_layout

\begin_layout Enumerate
Memory allocation and initialisation for both the stiffness matrix 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $W$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 and the right-hand side 
\begin_inset Formula $b$
\end_inset

.
\end_layout

\begin_layout Enumerate
Computation of the global stiffness matrix 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $W$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 and the global right-hand side 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $b$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 by computing and assembling up local ones.
\end_layout

\begin_layout Enumerate
Assignment of Dirichlet conditions.
\end_layout

\begin_layout Enumerate
Computation of the vector 
\begin_inset Formula $u$
\end_inset

 solution of 
\begin_inset Formula $Wu$
\end_inset


\begin_inset Formula $=b$
\end_inset

.
\end_layout

\begin_layout Subsection
Memory allocation and variable initialisation
\end_layout

\begin_layout Standard
The very first task the algorithm must handle is a proper dynamic memory
 allocation, to store both the stiffness matrix and the right-hand side.
 In order to improve memory usage and to make the access uniform, the matrix
 is stored as a linear 1D vector.
 Once allocated, all the elements of both the stiffness matrix and the right-han
d side must be set to zero, as the assembling procedure (
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Assembling-serial"

\end_inset

) requires.
 Disregarding the initial part that simply allocates required memory space,
 we notice that the initialisation actually results in 
\begin_inset Formula $n$
\end_inset

 store calls, 
\begin_inset Formula $n$
\end_inset

 being the dimension of the vector.
 In our case, that leads us to 
\begin_inset Formula $N^{2}+N$
\end_inset

 store calls, where 
\begin_inset Formula $N$
\end_inset

 equals the number of vertices in the given mesh.
 The function implementing allocation and initialisation is shown in Algorithm
 
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:Memory-allocation-serial"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

double* zeros(int dim) { 	
\end_layout

\begin_layout Plain Layout

	int i = 0;
\end_layout

\begin_layout Plain Layout

	double* vector = (double*) malloc(sizeof(double) * dim); 	
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < dim; i++) { 		
\end_layout

\begin_layout Plain Layout

		vector[i] = 0; 	
\end_layout

\begin_layout Plain Layout

	} 	
\end_layout

\begin_layout Plain Layout

	return vector; 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:Memory-allocation-serial"

\end_inset

Memory allocation and variable initialisation.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Assembling of the stiffness matrix and the right-hand side
\begin_inset CommandInset label
LatexCommand label
name "sub:Assembling-serial"

\end_inset


\end_layout

\begin_layout Standard
The assembling operation is realised by initially calling, for each one
 of the 
\begin_inset Formula $N$
\end_inset

 vertices in the mesh, two functions that compute local elements and then
 summing them back to the global ones.
 As every local contribute is summed to the existing values, the stiffness
 matrix and the vector should be initialised to zero.
 The map between triangles and local indices of triangles is stored in a
 preinitalized matrix.
 The code under consideration is shown Algorithm 
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:Assembling-serial"

\end_inset

.
\end_layout

\begin_layout Standard
Since the computation of local elements uses only values at the three vertices
 of the local triangle, its complexity is independent from 
\begin_inset Formula $N$
\end_inset

, and can thus be ignored.
 As a result, we can state that the overall complexity of the assembling
 task is 
\begin_inset Formula $O\left(N\right)$
\end_inset

, i.e.
 linear with respect to the dimension of the mesh.
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

for (tri = 0; tri < vertexSize; tri++) { 		
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < 3; i++) { 			
\end_layout

\begin_layout Plain Layout

		globalVertex = (int) *(vertexNumbers + tri * 3 + i) - 1; 			
\end_layout

\begin_layout Plain Layout

		vertices[i][0] = *(meshPoints + globalVertex * 2 + 0); 			
\end_layout

\begin_layout Plain Layout

		vertices[i][1] = *(meshPoints + globalVertex * 2 + 1); 		
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

		
\end_layout

\begin_layout Plain Layout

	localstiffnessMatrix(vertices, localW); 		
\end_layout

\begin_layout Plain Layout

	localVector(vertices, f, localB);
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	for (i = 0; i < 3; i++) { 			
\end_layout

\begin_layout Plain Layout

		globalVertex = (int) *(vertexNumbers + tri * 3 + i) - 1; 			
\end_layout

\begin_layout Plain Layout

		b[globalVertex] += localB[i]; 			
\end_layout

\begin_layout Plain Layout

		for (j = 0; j < 3; j++) { 				
\end_layout

\begin_layout Plain Layout

			globalVertex2 = (int) *(vertexNumbers + tri * 3 + j) - 1; 				
\end_layout

\begin_layout Plain Layout

			*(w + globalVertex * meshSize + globalVertex2) += localW[i][j]; 			
\end_layout

\begin_layout Plain Layout

		} 		
\end_layout

\begin_layout Plain Layout

	} 	
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:Assembling-serial"

\end_inset

Assembling of the stiffness matrix and the right-hand side.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Dirichlet conditions assignment
\end_layout

\begin_layout Standard
Before starting the computation of the solution, we must assign particular
 values to the stiffness matrix and the right-hand side in order to make
 Dirichlet conditions hold on the boundary of the domain.
 We have to retrieve the vertices on boundary of the domain and assign particula
r values at the correspondent row in the stiffness matrix and the right-hand
 side vector.
 By looking at the implementation - code is shown in Algorithm 
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:Dirichlet-serial"

\end_inset

 - we can notice that the number of operations is in the order of 
\begin_inset Formula $N\cdot\left(1+N_{boundary}\right)$
\end_inset

 where 
\begin_inset Formula $N_{boundary}$
\end_inset

 is the number of vertices on the boundary.
 Since this number grows almost linearly with 
\begin_inset Formula $N$
\end_inset

 when 
\begin_inset Formula $N$
\end_inset

 is big enough, the total amount of operations can be approximate with 
\begin_inset Formula $N\left(1+\alpha N\right)=N+\alpha N^{2}$
\end_inset

, which is 
\begin_inset Formula $O\left(N^{2}\right)$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

void assignDirichletCondition(int meshSize, double g, double* meshPoints,
 double* w, double* b) { 	
\end_layout

\begin_layout Plain Layout

	int i, j;
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < meshSize; i++) { 		
\end_layout

\begin_layout Plain Layout

		double x = *(meshPoints + 2 * i); 		
\end_layout

\begin_layout Plain Layout

		double y = *(meshPoints + 2 * i + 1); 		
\end_layout

\begin_layout Plain Layout

		if (fabs(x * x + y * y - 1) < TOL) { 			
\end_layout

\begin_layout Plain Layout

			for (j = 0; j < meshSize; j++) { 				
\end_layout

\begin_layout Plain Layout

				*(w + meshSize * i + j) = (i == j) ? 1 : 0; 			
\end_layout

\begin_layout Plain Layout

			} 			
\end_layout

\begin_layout Plain Layout

			b[i] = g; 		
\end_layout

\begin_layout Plain Layout

		} 	
\end_layout

\begin_layout Plain Layout

	} 
\end_layout

\begin_layout Plain Layout

} 
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:Dirichlet-serial"

\end_inset

Dirichlet conditions assignment.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Computation of the approximate solution
\end_layout

\begin_layout Standard
With both the matrix and the right-hand side properly assigned, it is possible
 to compute the FEM approximation of the solution 
\begin_inset Formula $u$
\end_inset

.
 As equation 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:FEM-sys"

\end_inset

 points out, the procedure requires to solve a linear system with 
\begin_inset Formula $N$
\end_inset

 equations in 
\begin_inset Formula $N$
\end_inset

 unknowns.
 The system is solved by two functions that implement the Gaussian Elimination
 algorithm: at first, the stiffness matrix and the right-hand side are modified
 with several pivot operations till an upper-triangular structure is reached;
 then the solutions is computed backward - Algorithm 
\begin_inset CommandInset ref
LatexCommand ref
reference "alg:GEM-serial"

\end_inset

.
 
\end_layout

\begin_layout Standard
The cost for computing the upper triangular system is in the order of 
\begin_inset Formula $\frac{N^{3}}{3}$
\end_inset

 ; the cost for solving the upper triangular system is 
\begin_inset Formula $N^{2}$
\end_inset

, so that the total asymptotically complexity is 
\begin_inset Formula $O\left(\frac{N^{3}}{3}+N^{2}\right)$
\end_inset

.
 
\end_layout

\begin_layout Standard
As we will see later, this is actually the bottleneck of the whole program.
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename image/GaussianAlgo.png
	width 38text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Gaussian elimination algorithm.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=C,numbers=left"
inline false
status open

\begin_layout Plain Layout

double* gaussianElimination(int n, double* matrix, double b[]) {
\end_layout

\begin_layout Plain Layout

	int i, j, k; 	
\end_layout

\begin_layout Plain Layout

	double aux, temp; 	
\end_layout

\begin_layout Plain Layout

	double* x = zeros(n);
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	/* Gaussian Elimination */
\end_layout

\begin_layout Plain Layout

	for (j = 0; j < (n - 1); j++) { 	
\end_layout

\begin_layout Plain Layout

		for (i = (j + 1); i < n; i++) { 			
\end_layout

\begin_layout Plain Layout

			aux = *(matrix + n * i + j) / *(matrix + n * j + j); 			
\end_layout

\begin_layout Plain Layout

			for (k = j; k < n; k++) { 				
\end_layout

\begin_layout Plain Layout

				*(matrix + n * i + k) -= (aux * (*(matrix + n * j + k))); 			
\end_layout

\begin_layout Plain Layout

			} 			
\end_layout

\begin_layout Plain Layout

			b[i] -= (aux * b[j]); 		
\end_layout

\begin_layout Plain Layout

		} 	
\end_layout

\begin_layout Plain Layout

	} 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	/* Back substitution */ 	
\end_layout

\begin_layout Plain Layout

	x[n - 1] = b[n - 1] / *(matrix + n * (n - 1) + n - 1); 	
\end_layout

\begin_layout Plain Layout

	for (i = (n - 2); i >= 0; i--) { 		
\end_layout

\begin_layout Plain Layout

		temp = b[i]; 		
\end_layout

\begin_layout Plain Layout

		for (j = (i + 1); j < n; j++) { 			
\end_layout

\begin_layout Plain Layout

			temp -= (*(matrix + n * i + j) * x[j]); 		
\end_layout

\begin_layout Plain Layout

		} 		
\end_layout

\begin_layout Plain Layout

		x[i] = temp / *(matrix + n * i + i); 	
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

	return x; 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "alg:GEM-serial"

\end_inset

Computation of the approximate solution.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Profiling the serial execution
\end_layout

\begin_layout Standard
After this brief study of the theoretical complexity of each kernel function,
 we shall now analyse the actual results obtained by running the code on
 a computer.
 
\end_layout

\begin_layout Standard
Several simulations were performed on an Intel i7-2630QM machine to study
 the computation time growth with respect to different mesh dimensions.
 All the interesting parameters related to the CPU under consideration are
 listed below.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="8">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Processor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
RAM
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Clock
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Cores
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Threads
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L1 cache
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L2 cache
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L3 cache
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
i7-2630QM
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4 GB
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 GHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4x32 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4x256 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6 MB 12-way
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Intel i7-2630QM features.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
For each function, we computed both the wall clock time, which is the actual
 amount of time taken to perform the job, and the CPU time, which is the
 amount of time the function actually holds the CPU during its execution.
 Common profiling tools, like gprof, offer a resolution in the order of
 the tenths of milliseconds: looking at the values in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Profiling-serial"

\end_inset

, we consider such a precision too little.
 Moreover, they regularly sample the call stack, introducing more instruction
 and thus generating an overhead which may lead to untrustworthy results.
 Hence, we used native functions, in particular 
\family typewriter
omp_get_wtime() 
\family default
of 
\family typewriter
omp.h
\family default
 for wall clock time and 
\family typewriter
clock()
\family default
 of 
\family typewriter
time.h
\family default
 for CPU time.
 Both timers has resolutions in the order of microseconds.
 
\end_layout

\begin_layout Standard
The raw data we collected are shown in the following Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Profiling-serial"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="11" columns="7">
<features rotate="0" islongtable="true" headTopDL="true" headBottomDL="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row endhead="true">
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Overall
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
IO
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Initialisation
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Assembling
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Dirichlet
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Gaussian Elimination
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000080
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000123
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000014
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000023
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000003
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000051
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000151
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000143
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000032
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000042
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000004
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000100
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000232
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000171
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000036
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000034
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000188
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001117
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000153
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000033
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000063
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000010
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001030
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
144
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006962
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000283
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000109
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000125
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000020
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006774
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.354619
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000901
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.004083
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000672
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000139
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.353258
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22.964478
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002509
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.023644
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003044
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000954
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22.951455
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
97.154916
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.004003
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.048192
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.004370
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001921
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
97.125484
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
513.562017
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.007300
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.150833
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.007964
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.004399
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
513.480326
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5563.750536
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.015359
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.754177
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.018652
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.014815
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5563.298515
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Profiling-serial"

\end_inset

Profiling of the serial execution time (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Since the simulations were run minimising the number of concurrent jobs
 other than the program under test, we notice that the wall clock time and
 CPU time do not actually differ significantly - see Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:CPU-vs-Wall"

\end_inset

.
 Hence, from now on we will consider just the CPU time measurement, indeed
 more significant.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/cpuClock.pdf
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Real scale.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/cpuClockZoom.pdf
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Zoom.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:CPU-vs-Wall"

\end_inset

CPU time and wall clock time (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
To better understand the results, for each function we plot both the expected
 trend and the real one; moreover, to highlight asymptotic complexity, we
 also provide log-log scale plots.
 On each plot, an equation showing the theoretical prediction has been added.
 It is the output of a least square regression performed on the data shown
 in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Profiling-serial"

\end_inset

 with the models described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Serial-implementation"

\end_inset

.
 
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/zeros.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Initialisation.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/assembling.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Assembling.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/dirichlet.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Dirichlet condition assignment.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/gauss.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Gaussian elimination (theoretical prediction is almost perfectly overlapped
 to simulation)
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Parallel implementation
\end_layout

\begin_layout Standard
The simulations run on the machine show how fast the computation time grows
 with respect to the mesh size.
 They also highlighted how the bottleneck of the whole program is the Gaussian
 Elimination algorithm, in agreement with what the theoretical study suggests.
 
\end_layout

\begin_layout Standard
Those results, however, are obtained by running the code in a serial fashion,
 thus wasting possible available parallelism offered by multicore machines.
 In other words, the application we considered till now is absolutely not
 scalable.
 A multicore machine, instead, lets us spread the job among cores, thus
 decreasing computation time with a factor theoretically equal to the number
 of available cores.
 Of course, this is never the case: because of data dependencies, only a
 fraction of the code can actually run in parallel.
 Moreover, when more than one thread is running, job distribution, resource
 access and synchronisation must be taken into account.
 The only way to do so is to add more instruction, thus slowing the execution.
 Parallelization is worth introducing only if the gain in computation speed
 is higher than the loss due to overhead.
\end_layout

\begin_layout Standard
As the code involves a lot of computations, an improvement in performance
 can be obtained: we shall see later in details how much and why.
\end_layout

\begin_layout Standard
The tools to build parallel code are provided by the Open-MP API interface,
 a set of compiler directives, library routines and environment variables
 that allow to build parallel applications on shared memory systems.
 We will not cover technical specifications for the API, since this is not
 the aim of this report.
 However, we will define and describe accurately every directive we actually
 use to develop the parallel code.
\end_layout

\begin_layout Standard
As we did for the serial ones, we will carry out the analysis function by
 function: for each one of them, we will study available parallelism and
 describe the implementation, along with the reasons beneath any choice
 we made.
\end_layout

\begin_layout Subsection
Memory allocation and variable initialisation
\end_layout

\begin_layout Standard
As we already described, this function allocates the memory required given
 the dimension of the linear vector, and eventually sets to zero the value
 of each element.
 Disregarding allocation, we notice that the operations are completely independe
nt one another, so the fraction 
\begin_inset Formula $fraction_{parallel}$
\end_inset

 of the code that can run in parallel is approximately 1.
 If 
\begin_inset Formula $t_{serial}$
\end_inset

 is the computation time of the serial execution and 
\begin_inset Formula $N$
\end_inset

 is the number of threads that run in parallel, one should have 
\begin_inset Formula 
\begin{equation}
t_{parallel}=(1-fraction_{parallel})\cdot t_{serial}+fraction_{parallel}\cdot\frac{t_{serial}}{N}\simeq\frac{t_{serial}}{N}
\end{equation}

\end_inset

which represents an ideal speed-up equal to the number of running threads.
 The parallel implementation is shown in the 
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

double* zeros(int dim) { 	
\end_layout

\begin_layout Plain Layout

	int i = 0; 	
\end_layout

\begin_layout Plain Layout

	double* vector __attribute__ ((aligned (16))); 	
\end_layout

\begin_layout Plain Layout

	vector = (double*) malloc(sizeof(double) * dim); 
\end_layout

\begin_layout Plain Layout

#pragma omp parallel for private(i) schedule(static) 	
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < dim; i++) { 		
\end_layout

\begin_layout Plain Layout

		vector[i] = 0; 	
\end_layout

\begin_layout Plain Layout

	} 	
\end_layout

\begin_layout Plain Layout

	return vector;
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Memory allocation and variable initialisation.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The whole procedure is realised by a loop that scans the vector and writes
 into indexed element.
 Hence, the parallelization is realised using the directive 
\family typewriter
#pragma omp paralell for
\family default
, that splits the iteration among threads and then let them execute.
 The clause 
\family typewriter
private(i)
\family default
 specifies that the variable used as loop counter has to be private for
 each thread: we thus avoid the same element of the vector to be processed
 by more than one thread.
 We observed that every basic operation is a single 
\family typewriter
store
\family default
: the computational load is evenly distributed among all the threads.
 This is the reason why we decided to use the 
\family typewriter
schedule(static)
\family default
 clause, which assign the same number of iterations to every thread.
 By default openMP gives every thread the total number of iteration divided
 by the number of threads, avoiding further distribution and thus keeping
 the granularity as low as possible and minimising the overhead.
\end_layout

\begin_layout Standard
The reason why an 
\family typewriter
__attribute__ ((aligned (16)))
\family default
 has been added to the declaration of the vector will be explained in Section
 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Beyond-instruction"

\end_inset

.
\end_layout

\begin_layout Subsection
Assembling of the stiffness matrix and the right-hand side
\begin_inset CommandInset label
LatexCommand label
name "sub:Assembling-par-analysis"

\end_inset


\end_layout

\begin_layout Standard
The assembling procedure is made of several nested loops: each loop, but
 the outer one, contains a relatively small number of operations.
 Each iteration of the outer loop is independent from all the others, so
 it can be turned in a single parallel region.
 However, updates to the global stiffness matrix and the global right-hand
 side must be carefully handled.
 The pointers to the data structures are shared among all the running threads;
 but they must be accessed serially in order to prevent unpredictable results.
 If every memory access were negligible, the expected speedup would be close
 to the number of threads.
 However, this algorithm requires the access to four different data structure:
 the matrix of the global indices of vertices, the matrix of their coordinates,
 the stiffness matrix and the right-hand side vector.
 As the global index of the vertices of the triangle are almost randomly
 distributed, the other data structures are not accessed with a regular
 pattern, thus stressing memory hierarchy.
 Considering, for instance, the biggest mesh size 
\begin_inset Formula $M$
\end_inset

 we used, we can compute the size 
\begin_inset Formula $W_{b}$
\end_inset

 of the stiffness matrix in byte:
\begin_inset Formula 
\begin{equation}
W_{b}=M\cdot M\cdot8=13693^{2}\cdot8\simeq1,4\;GB
\end{equation}

\end_inset

An irregular access pattern to such a matrix is likely to generate a lot
 of full misses in the cache hierarchy.
 Moreover, updates must be execute by one thread only.
 As the bottleneck of the algorithm is memory access, we expect the parallelizat
ion not to lead to a significant performance improvement: the overhead the
 management of threads introduces is likely to nullify the gain in computational
 time consumption.
 The code for the parallel version of the function is shown below.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

#pragma omp parallel for private(tri, i, j, globalVertex, globalVertex2,
 vertices, localW, localB) schedule(static)
\end_layout

\begin_layout Plain Layout

for (tri = 0; tri < vertexSize; tri++) {
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < 3; i++) { 			
\end_layout

\begin_layout Plain Layout

		globalVertex = (int) *(vertexNumbers + tri * 3 + i) - 1; 			
\end_layout

\begin_layout Plain Layout

		vertices[i][0] = *(meshPoints + globalVertex * 2 + 0); 			
\end_layout

\begin_layout Plain Layout

		vertices[i][1] = *(meshPoints + globalVertex * 2 + 1); 		
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

		
\end_layout

\begin_layout Plain Layout

	localstiffnessMatrix(vertices, localW); 		
\end_layout

\begin_layout Plain Layout

	localVector(vertices, f, localB);
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	for (i = 0; i < 3; i++) { 			
\end_layout

\begin_layout Plain Layout

		globalVertex = (int) *(vertexNumbers + tri * 3 + i) - 1;
\end_layout

\begin_layout Plain Layout

#pragma omp critical			
\end_layout

\begin_layout Plain Layout

		b[globalVertex] += localB[i]; 			
\end_layout

\begin_layout Plain Layout

		for (j = 0; j < 3; j++) { 				
\end_layout

\begin_layout Plain Layout

			globalVertex2 = (int) *(vertexNumbers + tri * 3 + j) - 1;
\end_layout

\begin_layout Plain Layout

#pragma omp critical				
\end_layout

\begin_layout Plain Layout

			*(w + globalVertex * meshSize + globalVertex2) += localW[i][j]; 			
\end_layout

\begin_layout Plain Layout

		} 		
\end_layout

\begin_layout Plain Layout

	} 	
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Assembling of the stiffness matrix and the right-hand side
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The cycle is made parallel with a 
\family typewriter
#pragma omp paralell for 
\family default
clause.
 All the variables which refers to the local element and the position where
 their contribution has to be added on the global stiffness matrix has to
 be private.
 The static scheduling is chosen because all the iterations are given the
 same workload: computing fixed-dimension local matrix and vector and summing
 them up to the global terms.
 However, as the theoretical introduction points out, we have to guarantee
 that one thread only is managing the global matrix at the same time: this
 is the reason why we have to add a 
\family typewriter
#pragma omp critical 
\family default
clause to every instruction which reads or writes in the global matrix.
 
\end_layout

\begin_layout Subsection
Dirichlet conditions assignment
\end_layout

\begin_layout Standard
The kernel of the function is a 
\family typewriter
for
\family default
 loop which scans every row of the matrix and overwrites all the elements
 in some of them.
 As either one or no row is modified in every iteration, the are no dependencies
 between them.
 Theoretically, every iteration could run in parallel: in practice, the
 maximum number of threads the machine can execute in the same time is a
 physical limit.
 Theoretically, the maximum time gain could be achieved:
\begin_inset Formula 
\begin{equation}
t_{parallel}=(1-fraction_{parallel})\cdot t_{serial}+fraction_{parallel}\cdot\frac{t_{serial}}{N}\simeq\frac{t_{serial}}{N}
\end{equation}

\end_inset

The code below shows the whole cycle included in a 
\family typewriter
#pragma omp paralell 
\family default
directive.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

void assignDirichletCondition(int meshSize, double g, double* meshPoints,
 double* w, double* b) { 	
\end_layout

\begin_layout Plain Layout

	int i, j;
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

#pragma omp parallel for private(i, j) schedule(dynamic)
\end_layout

\begin_layout Plain Layout

	for (i = 0; i < meshSize; i++) { 		
\end_layout

\begin_layout Plain Layout

		double x = *(meshPoints + 2 * i); 		
\end_layout

\begin_layout Plain Layout

		double y = *(meshPoints + 2 * i + 1); 		
\end_layout

\begin_layout Plain Layout

		if (fabs(x * x + y * y - 1) < TOL) { 			
\end_layout

\begin_layout Plain Layout

			for (j = 0; j < meshSize; j++) { 				
\end_layout

\begin_layout Plain Layout

				*(w + meshSize * i + j) = (i == j) ? 1 : 0; 			
\end_layout

\begin_layout Plain Layout

			} 			
\end_layout

\begin_layout Plain Layout

			b[i] = g; 		
\end_layout

\begin_layout Plain Layout

		} 	
\end_layout

\begin_layout Plain Layout

	} 
\end_layout

\begin_layout Plain Layout

} 
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Dirichlet conditions assignment
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The description of the algorithm suggest the load may be unfairly distributed
 among different threads.
 An iteration where the 
\family typewriter
if()
\family default
 clause is true is much more demanding than one where the same condition
 is false.
 A true condition leads to 
\begin_inset Formula $n$
\end_inset

 additional operation, where 
\begin_inset Formula $n$
\end_inset

 is the number of vertices of the mesh: moreover, it requires to access
 a different matrix form the one which the condition is tested on.
 The cache penalty is likely to be paid.
 The 
\family typewriter
schedule(dynamic)
\family default
 clause faces the problem by assigning a new bunch of iteration to the first
 thread which completes its job.
 The aim is keeping the maximum number of threads working until the whole
 cycle is over.
 The price to pay is the overhead of the repeated job assignment: however,
 it is much efficient than keeping one ore more threads inactive.
 
\end_layout

\begin_layout Subsection
Computation of the approximate solution
\end_layout

\begin_layout Standard
\begin_inset Wrap figure
lines 0
placement o
overhang 0in
width "40col%"
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/GaussianElimination.png
	width 38text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Scheme-of-GEM"

\end_inset

Scheme of Gaussian elimination algorithm.
\end_layout

\end_inset


\end_layout

\end_inset

As the amount of time required to perform gaussian elimination is way less
 than the one taken by the back substitution, we present only the parallel
 version of the former.
 As the serial profiling outlines, this function is the by far the most
 time-consuming of the whole program, so a dependency analysis is required
 to better understand which parts of the algorithm can be executed in parallel.
 The picture 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Scheme-of-GEM"

\end_inset


\begin_inset Foot
status collapsed

\begin_layout Plain Layout
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://riebecca.blogspot.it/2008/12/supercomputing-course-openmp-syntax-and_15.html
\end_layout

\end_inset


\end_layout

\end_inset

 shows which elements of the starting matrix 
\begin_inset Formula $A\in\mathbb{R}^{n\times n}$
\end_inset

 are updated.
 The kernel is composed by three loops: the first one scans the column of
 
\begin_inset Formula $A$
\end_inset

: at its 
\begin_inset Formula $k$
\end_inset

-th iteration, it reads the elements in the 
\begin_inset Formula $k$
\end_inset

-th row and updates all the element 
\begin_inset Formula $a_{i,j}$
\end_inset

 such that 
\begin_inset Formula $i>k$
\end_inset

 and 
\begin_inset Formula $j\geq k$
\end_inset

.
 As the values in the 
\begin_inset Formula $k$
\end_inset

-th row have been updated until the 
\begin_inset Formula $k-1$
\end_inset

-th iteration, every iteration is dependent on the previous.
 Every kind of parallelization is thus forbidden.
 However, the update is performed via two more loops which scan the sub-matrix
 
\begin_inset Formula $\tilde{A}=\left\{ a_{i,j}\right\} _{i,j>k}$
\end_inset

 - in green in Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Scheme-of-GEM"

\end_inset

.
 The update of a row of 
\begin_inset Formula $\tilde{A}$
\end_inset

 depends only on the elements of that row and on the 
\begin_inset Formula $k$
\end_inset

-th row of 
\begin_inset Formula $A$
\end_inset

, so all the rows can be processed in parallel.
 As all the time-consuming operations are performed inside the parallel
 loop, we expect the parallel algorithm to last 
\begin_inset Formula $\frac{1}{N}$
\end_inset

 times the serial one, where 
\begin_inset Formula $N$
\end_inset

 is the number of threads.
 However, a non negligible overhead is introduced by the thread management
 and synchronisation and the job assignments.
 All these operations have to be repeated for every iteration of the outer
 loops.
 The parallel version of the function is shown below.
\end_layout

\begin_layout Standard
\begin_inset Float algorithm
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

void gaussianElimination(int n, double* matrix, double b[]){ 	
\end_layout

\begin_layout Plain Layout

	int j, i, k; 	
\end_layout

\begin_layout Plain Layout

	double aux;
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	for (j = 0; j < (n - 1); j++) { 
\end_layout

\begin_layout Plain Layout

#pragma omp parallel for private(aux, i, k) schedule(dynamic) 		
\end_layout

\begin_layout Plain Layout

		for (i = (j + 1); i < n; i++) { 			
\end_layout

\begin_layout Plain Layout

			aux = *(matrix + n * i + j) / *(matrix + n * j + j); 			
\end_layout

\begin_layout Plain Layout

			for (k = j; k < n; k++) { 				
\end_layout

\begin_layout Plain Layout

				*(matrix + n * i + k) -= (aux * (*(matrix + n * j + k))); 			
\end_layout

\begin_layout Plain Layout

			} 			
\end_layout

\begin_layout Plain Layout

			b[i] -= (aux * b[j]); 		
\end_layout

\begin_layout Plain Layout

		} 	
\end_layout

\begin_layout Plain Layout

	} 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Computation of the approximate solution
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
We decide to put the 
\family typewriter
#pragma omp parallel for
\family default
 clause on the outer of the two parallelizable loops to avoid too many thread
 creation and deletion.
 Following the result of a previous study
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
S.F.McGinn & R.E.Shaw, Parallel Gaussian Elimination Using OpenMP and MPI, 
\begin_inset Flex URL
status collapsed

\begin_layout Plain Layout

http://www3.nd.edu/~zxu2/acms60212-40212-S12/Gaussian-openMP.pdf
\end_layout

\end_inset


\end_layout

\end_inset

 we choose dynamic scheduling.
 However, Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Scheme-of-GEM"

\end_inset

 shows that the workload changes for every iteration of the outer serial
 loop, while it remains constant over the iteration of the inner parallel
 loop.
 Thus, we believe a static scheduling could outperform a dynamic one, as
 it prevents the overhead for several job assignment among different threads.
 Data supporting our prediction are shown in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Static-and-dynamic"

\end_inset

.
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="3">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Dynamic
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Static
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22.951455
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
19.608431
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
97.125484
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
77.959359
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
513.480326
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
487.208414
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Static-and-dynamic"

\end_inset

Static and dynamic execution timing (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Profiling the parallel execution
\end_layout

\begin_layout Standard
As we did for the serial execution, we shall now proceed analysing the execution
 of the parallel code on computer machines.
 The profiling operations are made in the same way of the serial one, but
 this time simulations are run on different machines in order to study the
 speed-up of parallel code with respect to the number of available cores/threads.
 All interesting parameters related to the processors under consideration
 are listed below.
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="8">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Processor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
RAM
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Clock
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Cores
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Threads
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L1 I/D-cache
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L2 cache
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
L3 cache
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
i7-2630QM
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4 GB
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 GHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4x32 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4x256 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6 MB 12-way
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
i5-4210U
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
16 GB
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.7 GHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x32 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x256 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3 MB 12-way
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
i3-370M
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4 GB
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.4 GHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x32 KB 2/4-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x256 KB 8-way
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3 MB 12-way
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Processors features.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
We will consider function by function the effect of the applied parallelization
 and compare it to the theoretical behaviour predicted before.
 For each kernel function we will show raw data, trends of computational
 time and computed speed-up, which is the ratio between serial code computationa
l time and parallel one.
 Then we will comment the results and discuss whether or not they fit the
 theoretical prediction.
\end_layout

\begin_layout Standard
For each kernel function we will plot the trends of computational time for
 the different machines, along with the serial one.
 
\end_layout

\begin_layout Subsection
Memory allocation and variable initialisation
\end_layout

\begin_layout Standard
As we expected, the overall CPU time the function requires to complete is
 significantly reduced by the parallel implementation.
 Apart form noise, the speedup is almost invariant with respect to the mesh
 size, as we may expect form such a regular pattern of operations.
 However, we expected a speedup very similar to the number of cores, but
 the simulation results show that the real gain is almost the half.
 We find two major causes of the difference: first of all, the number of
 thread is two times the cores, thanks to Intel hyper-threading.
 It means that two instruction flows are in execution on the same core:
 when the first is blocked, the second proceeds.
 However, this leads to a less significant improvement than two physical
 cores.
 On the other hand, a non negligible time is wasted in memory access: this
 part of the code can hardly be made parallel by the software.
 So, the real speedup is significant, but not as high as theoretical speculation
s foresaw.
 
\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="11" columns="5">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM Parallel
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000029
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005196
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005953
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.010246
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000022
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000059
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000012
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000023
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001351
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000065
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000006
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000077
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005049
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000087
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000014
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
144
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00017
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000064
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000115
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000033
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00181
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001664
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001129
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000334
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.024207
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.013216
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.010397
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.008686
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.062386
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.032585
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.026124
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01721
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.187715
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.100648
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.115271
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.055533
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.335043
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.510255
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.434716
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.278116
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Computational time for memory allocation and variable initialisation (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/zerosP.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Memory allocation and initialisation time over mesh size.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.83
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.11
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.72
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.91
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.15
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.80
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.86
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.65
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.71
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.61
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.06
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.71
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Speed-Up for memory allocation and variable initialisation
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Assembling the stiffness matrix and the right-hand side
\end_layout

\begin_layout Standard
Being the piece of code which is most difficult to make parallel, as paragraph
 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Assembling-par-analysis"

\end_inset

 points out, we expect little speedup.
 However, the parallel code is even slower than the serial one.
 We believe the critical regions to be the reason: because of the irregular
 access pattern to the global matrix, most of the time is spent in updating
 values in RAM memory.
 This operation cannot be made parallel, so we nullify the gain in computations
 speed by making the threads wait their turn to enter the critical regions.
 In order to prove the hypothesis, we run on the i3-370M machine a simulation
 where the critical region are wiped out.
 The results are shown in table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Execution-crit-non-crit"

\end_inset

.
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Parallel without critical regions
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001667
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006988
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001227
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003327
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.011121
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002010
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.007782
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.020323
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003701
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.026694
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.053064
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.011567
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Execution time with and without critical regions (seconds).
\begin_inset CommandInset label
LatexCommand label
name "tab:Execution-crit-non-crit"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

Without the critical regions, the parallel code performs much better than
 the serial one, while the performance drops when the blocking memory management
 is imposed.
 However, wiping the critical regions out is not a feasible solution, as
 the output of the program which run without them is incoherent with the
 one of the other executions and with the real solution of the partial different
ial equation.
 We have to conclude that, in a real-life situation, such an algorithm is
 not worth parallelizing without previous modifications.
 
\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="11" columns="5">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM Parallel
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00001
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000075
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000012
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001842
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000013
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001905
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000017
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000116
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000015
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000101
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000022
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000155
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000035
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000929
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000042
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000299
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
144
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000042
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00037
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000092
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000602
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000217
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001505
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000361
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002575
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001667
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006988
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00207
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01076
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003327
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.011121
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003153
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.016062
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.007782
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.020323
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006971
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.028417
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.026694
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.053064
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.021285
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.06478
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Computational time for assembling (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/assemblingP.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Assembling time over mesh size.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.23
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.03
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.28
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.29
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.98
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.27
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.38
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.01
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.28
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.50
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.92
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.28
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Speed-Up for assembling
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Dirichlet conditions assignment
\end_layout

\begin_layout Standard
Simulations show that the parallel version is faster than the serial one,
 as we expected from a priori study.
 By spreading the condition assignment among threads, we obtained a relevant
 speedup, although not as high as we predicted.
 Again, this is caused either by hyper-threading, which let two threads
 run on the same core alternatively thus decreasing performance, either
 by overhead, in this case indeed relevant due to repeated assignment caused
 by 
\family typewriter
schedule(dynamic)
\family default
clause.
 As a result, we see a speedup which is approximately half the number of
 threads.
\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="11" columns="5">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM Parallel
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00001
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000007
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000036
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000006
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000013
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003206
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000032
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000005
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000015
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000005
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000034
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000005
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000035
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000011
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000041
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000006
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
144
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000042
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000017
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000051
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00001
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000217
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000105
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000136
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000045
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001667
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000798
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000538
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000639
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.003327
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001593
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00103
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000587
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.007782
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00373
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002519
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001411
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.026694
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.013636
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.009478
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.004924
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Computational time for Dirichlet conditions assignment (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/dirichletP.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Dirichlet condition assignment time over mesh size.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.08
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.69
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.49
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.08
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.77
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.27
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.08
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.91
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.11
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.95
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.53
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.00
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Speed-Up for Dirichlet conditions assignment
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Computation of the approximate solution
\end_layout

\begin_layout Standard
The results below show how the parallel version behaved in simulations with
 respect to the serial one: a non negligible speedup is obtained, though
 not as high as one could expect.
 In addition to what has already been told, it is important to notice that
 the parallelization directive stays inside the outer loop, thus requiring
 more overhead and decreasing the speedup.
 This is also made worse by the dynamic job assignment.
 Resulting data and figures are shown below.
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="11" columns="5">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U Parallel
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM Parallel
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
25
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000195
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000112
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000648
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.00006
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
33
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000415
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002478
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000925
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000096
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
41
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000766
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000223
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.001608
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000135
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
75
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002327
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.002265
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.006143
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.000739
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
144
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.015817
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.005991
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.010579
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.01123
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.630275
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.309024
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.209555
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.116902
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
40.413426
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
19.283026
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
11.97183
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6.636739
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
161.381916
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
76.948164
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
47.403249
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
24.503626
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
890.467981
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
427.581916
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
259.603595
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
141.665447
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
10079.206121
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6045.163729
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2939.631746
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2003.69768
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Computational time for solving the system (seconds).
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/gaussP.eps
	width 100text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Gaussian elimination time over mesh size.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i3-370M
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i5-4210U
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\series bold
i7-2630QM
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.09
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.31
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.45
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.09
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.30
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.96
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.08
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.31
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.62
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.66
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.30
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.77
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Speed-Up for solving the system
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Section
Beyond instruction parallelism
\begin_inset CommandInset label
LatexCommand label
name "sec:Beyond-instruction"

\end_inset


\end_layout

\begin_layout Standard
As a final experiment, we try to let the gcc compiler optimise the machine
 code at its best.
 By default, the GNU compiler goes for compilation speed
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
GNU gcc official documentation, 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html
\end_layout

\end_inset


\end_layout

\end_inset

 and neglect assembly optimisation.
 However, when we consider the Finite Elements algorithm, compilation speed
 is a minor concern if compared to execution speed.
 Looking at the code, we con identify several possible ways to optimise
 the flow of machine instructions: 
\end_layout

\begin_layout Itemize
All the functions we presented and analysed in the previous chapters involves
 lots of floating points operation: some of them are performed in the same
 way on consecutive elements of a vector.
 We could get a double throughput if we processed two elements at once via
 vectorised operations.
\end_layout

\begin_layout Itemize
The kernel of most function is made of nested for loops, each of them made
 of a small amount of instruction.
 At assembling level, it means a big waste in time for the control instruction
 (testing the counter, jumping, ...).
 A solution is loop unrolling, that is merging more than one small iteration
 into a single longer one.
 This procedure is limited by data dependency and by the actual number of
 available registers.
\end_layout

\begin_layout Itemize
The data the algorithm requires are stored in large data structure in ram
 memory.
 Even when cache hierarchy works at its best - we pointed out it is not
 always the case - every access to a resource which is outside the core
 is expensive.
 Optimising the memory access could lead to a big performance improvement.
\end_layout

\begin_layout Standard
A human optimisation of such a complex procedure would be difficult and
 may lead to several mistakes.
 However, gcc compiler provides options to turn on automatic assembly optimisati
on.
 We launched a compilation on the i7-2630QM machine with the following command:
 
\begin_inset Flex Code
status open

\begin_layout Plain Layout
gcc -Wall -O3 -msse2 -fopenmp main.c -o main
\end_layout

\end_inset

.
 The 
\family typewriter
-O3
\family default
 flag make the compiler try all the improvements in the previous list: the
 
\family typewriter
-msse2
\family default
 options let the compiler use special 128-bit-long registers to perform
 vectorised operations.
 We profiled the execution and we shall present a comparison with the unoptimise
d code.
\end_layout

\begin_layout Subsection
A bit of insight: profiling the optimised code
\end_layout

\begin_layout Standard
We provide a tabular and a graphical visualisation of the performance of
 the optimised code over the serial one we considered until now - Table
 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Speedup-of-optimised"

\end_inset

 and Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Optimised-and-non-profiling"

\end_inset

.
 As we may expect, a substantial improvement has been achieved in all the
 functions we considered.
 However, the most important gain concerns the Gaussian elimination algorithm.
 We try to understand why the improvement is so huge asking the compiler
 to log vectorizations and loop unrolling.
 Among the output, we get the following lines:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

parallelMain.c:121: note: vectorized 1 loops in function.
\end_layout

\begin_layout Plain Layout

parallelMain.c:130: note: LOOP VECTORIZED.
\end_layout

\end_inset

Line 130 is part of the function implementing gaussian elimination and contains
 the inner loop which scans one of the columns of the submatrix to be updated.
 Since this loop is repeated for all the columns of the stiffness matrix
 and for all the rows of the submatrix to update, a speedup concerning this
 fragment of code is critical for the overall performance.
 Even if a deep analysis of the assembly the compiler produces is beyond
 the aim of this report, we look for traces of the vectorization.
 In a piece of code which is supposed to be part of the translation of the
 gaussian elimination algorithm, we find the following lines:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

movsd  xmm0,QWORD PTR [rdx+rax*1]      
\end_layout

\begin_layout Plain Layout

movhpd xmm1,QWORD PTR [rcx+rax*1+0x8]      
\end_layout

\begin_layout Plain Layout

movhpd xmm0,QWORD PTR [rax+rdx*1+0x8]
\end_layout

\begin_layout Plain Layout

mulpd  xmm1,xmm3      
\end_layout

\begin_layout Plain Layout

subpd  xmm0,xmm1
\end_layout

\end_inset

In Intel Instruction Set Architecture (ISA), 
\family typewriter
xmm* 
\family default
registers are 128-bit long and are used to perform vectorised operations.
 Without any modification of the code, the compiler exploited its knowledge
 of the program and the hardware of the machine to speed mathematical operations
 up.
 The only help we give it is the 
\family typewriter
__attribute__(aligned(16))
\family default
 clause we add to vectors declaration to make them 16-byte aligned in memory
 and enhance the effectiveness of vectorised operations.
\end_layout

\begin_layout Standard
In the output of the optimised compilation, we find the trace of several
 loop unrollings: 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

parallelMain.c:75: note: Completely unroll loop 2 times
\end_layout

\begin_layout Plain Layout

parallelMain.c:48: note: Completely unroll loop 3 times
\end_layout

\begin_layout Plain Layout

parallelMain.c:214: note: Completely unroll loop 3 times
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The first and the second loop are part of the secondary functions which
 compute local stiffness matrix, while the latter is placed inside the assemblin
g procedure.
\end_layout

\begin_layout Standard
Altogether, the optimisation of the assembling let the program gain a greater
 speedup than the mere parallelization of sections of code.
 
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="5">
<features rotate="0" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Mesh Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Initialisation
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Assembling
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Dirichlet assignment
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gaussian Elimination
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2173
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.38
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.93
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.73
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.84
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3447
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.58
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.67
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.84
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6.19
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6084
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.59
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.65
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.82
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6.03
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
13693
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.81
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.65
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.90
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5.80
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Speedup of optimised code over non optimised serial.
\begin_inset CommandInset label
LatexCommand label
name "tab:Speedup-of-optimised"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/zerosOpt.eps
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Initialisation.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/assemblingOpt.eps
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Assembling.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/dirichletOpt.eps
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Dirichlet condition assignment.
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename image/gaussOpt.eps
	width 50text%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Gaussian elimination
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
Optimised and non optimised code execution time over mesh size.
\begin_inset CommandInset label
LatexCommand label
name "fig:Optimised-and-non-profiling"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
